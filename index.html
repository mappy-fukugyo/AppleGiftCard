<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒƒãƒ—ãƒ«ã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰ç®¡ç†ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif; background-color: #f4f7f9; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 1300px; margin: auto; background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .main-header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 2px solid #3498db; margin-bottom: 20px;}
        h1 { color: #2c3e50; padding-bottom: 10px; margin: 0; width: 100%; border-bottom: none; }
        h1[contenteditable="true"]:focus { outline: 2px solid #3498db; background-color: #f0f8ff; }
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        details { border: 1px solid #ddd; border-radius: 5px; margin-left: 20px; flex-shrink: 0; width: 350px; position: relative; }
        summary { font-weight: bold; cursor: pointer; padding: 10px 15px; background-color: #f9f9f9; }
        .instructions { position: absolute; right: 0; top: 100%; width: 100%; background-color: white; border: 1px solid #ddd; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 10; padding: 0 20px 20px 20px; max-height: 400px; overflow-y: auto; box-sizing: border-box; }
        .summary-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .summary-box { background-color: #ecf0f1; border-radius: 8px; padding: 20px; text-align: center; }
        .summary-box h3 { margin: 0 0 10px 0; color: #344e5e; font-size: 16px; }
        .summary-box .value { font-size: 28px; font-weight: bold; color: #2c3e50; }
        form { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 8px; font-weight: bold; font-size: 14px; }
        input, select, textarea { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; width: 100%; box-sizing: border-box; height: 40px; }
        textarea { height: auto; }
        .form-actions { grid-column: 1 / -1; display: flex; justify-content: flex-end; gap: 15px; margin-top: 15px; }
        .btn { padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; }
        .btn-primary { background-color: #3498db; color: white; }
        .btn-secondary { background-color: #95a5a6; color: white; }
        .btn-export { background-color: #27ae60; color: white; }
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; white-space: nowrap; }
        thead th { background-color: #ecf0f1; }
        tr.status-unused { background-color: #e6ffed; }
        tr.status-charged { background-color: #fff9e6; }
        tr.status-spent { background-color: #f2f2f2; color: #7f8c8d; text-decoration: line-through; }
        .action-btn, .copy-btn-table { padding: 5px 10px; margin-right: 5px; border-radius: 4px; border: none; color: white; cursor: pointer; text-decoration: none; font-size: 12px;}
        .edit-btn { background-color: #2980b9; }
        .delete-btn { background-color: #c0392b; }
        .copy-btn-table { background-color: #7f8c8d; }
        footer { text-align: center; margin-top: 25px; font-size: 14px; color: #555; }
        footer a { color: #3498db; text-decoration: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-header">
            <h1 id="main-title" contenteditable="true">ã‚¢ãƒƒãƒ—ãƒ«ã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰ç®¡ç†ãƒ„ãƒ¼ãƒ« ğŸ</h1>
            <details>
                <summary>â–¼ ä½¿ã„æ–¹</summary>
                <div class="instructions">
                    <h3>ã¯ã˜ã‚ã«</h3>
                    <ul>
                        <li><strong>å®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³:</strong> ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šä¸è¦ã§å‹•ä½œã—ã¾ã™ã€‚</li>
                        <li><strong>é«˜ã„å®‰å…¨æ€§:</strong> ãƒ‡ãƒ¼ã‚¿ã¯ã‚ãªãŸã®PCã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ã€‚</li>
                    </ul>
                    <h3>ç”»é¢ã®èª¬æ˜</h3>
                    <ul>
                        <li><strong>ã‚µãƒãƒªãƒ¼:</strong> ã€Œæœªä½¿ç”¨ã€ã€Œãƒãƒ£ãƒ¼ã‚¸æ¸ˆã€ã€Œä½¿ç”¨æ¸ˆã€ã®åˆè¨ˆé¡ãŒè‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ã€‚</li>
                        <li><strong>ãƒãƒ£ãƒ¼ã‚¸å…ˆ:</strong> ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ã€Œãƒãƒ£ãƒ¼ã‚¸æ¸ˆã€ã‚’é¸ã¶ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</li>
                        <li><strong>ä¸€è¦§ã®è‰²åˆ†ã‘:</strong> ã‚«ãƒ¼ãƒ‰ã®çŠ¶æ…‹ãŒä¸€ç›®ã§åˆ†ã‹ã‚‹ã‚ˆã†ã«è‰²åˆ†ã‘ã•ã‚Œã¾ã™ã€‚</li>
                    </ul>
                    <h3>ã€é‡è¦ã€‘ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</h3>
                    <p>ãƒ–ãƒ©ã‚¦ã‚¶ã®å±¥æ­´ã‚’æ¶ˆå»ã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ã‚‚æ¶ˆãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å®šæœŸçš„ã«ã€Œã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸å‡ºåŠ›ã€ãƒœã‚¿ãƒ³ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã£ã¦ãã ã•ã„ã€‚</p>
                </div>
            </details>
        </div>
        
        <div class="summary-container">
            <div class="summary-box"><h3>æœªä½¿ç”¨ã®åˆè¨ˆé¡</h3><p class="value" id="total-unused-value">0å††</p></div>
            <div class="summary-box"><h3>ãƒãƒ£ãƒ¼ã‚¸æ¸ˆã®åˆè¨ˆé¡</h3><p class="value" id="total-charged-value">0å††</p></div>
            <div class="summary-box"><h3>ä½¿ç”¨æ¸ˆã®åˆè¨ˆé¡</h3><p class="value" id="total-spent-value">0å††</p></div>
        </div>

        <h2 id="form-header">ã‚¢ãƒƒãƒ—ãƒ«ã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰ã®è¨˜éŒ²</h2>
        <form id="agc-form">
            <input type="hidden" id="edit-index">
            <div class="form-group"> <label for="purchase-date">è³¼å…¥æ—¥</label> <input type="date" id="purchase-date" required> </div>
            <div class="form-group"> <label for="source">è³¼å…¥å…ƒ</label> <input type="text" id="source" placeholder="ä¾‹: Apple Store"> </div>
            <div class="form-group"> <label for="amount">é‡‘é¡ (å††)</label> <input type="number" id="amount" required placeholder="10000"> </div>
            <div class="form-group"> <label for="code">ã‚³ãƒ¼ãƒ‰</label> <input type="text" id="code"> </div>
            <div class="form-group"> <label for="status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                <select id="status">
                    <option value="æœªä½¿ç”¨" selected>æœªä½¿ç”¨</option>
                    <option value="ãƒãƒ£ãƒ¼ã‚¸æ¸ˆ">ãƒãƒ£ãƒ¼ã‚¸æ¸ˆ</option>
                    <option value="ä½¿ç”¨æ¸ˆ">ä½¿ç”¨æ¸ˆ</option>
                </select>
            </div>
            <div class="form-group" id="charge-to-group" style="visibility: hidden;"> <label for="charge-to">ãƒãƒ£ãƒ¼ã‚¸å…ˆ</label> <input type="text" id="charge-to" placeholder="ä¾‹: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆâ‘ "> </div>
            <div class="form-group"> <label for="memo">ãƒ¡ãƒ¢</label> <textarea id="memo" rows="1"></textarea> </div>
            <div class="form-actions"> <button type="submit" id="submit-btn" class="btn btn-primary">ç™»éŒ²ã™ã‚‹</button> <button type="button" id="cancel-btn" class="btn" style="background-color:#95a5a6; color:white; display:none;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button> </div>
        </form>

        <h2>ç™»éŒ²æ¸ˆã‚¢ãƒƒãƒ—ãƒ«ã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰ä¸€è¦§</h2>
        <div class="form-actions" style="justify-content: flex-start; margin-top:0;"> <button id="export-btn" class="btn" style="background-color:#27ae60; color:white;">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸å‡ºåŠ›</button> </div>
        <div class="table-wrapper">
            <table id="agc-table">
                <thead> <tr>
                    <th>è³¼å…¥æ—¥</th><th>è³¼å…¥å…ƒ</th><th>é‡‘é¡</th><th>ã‚³ãƒ¼ãƒ‰</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>ãƒãƒ£ãƒ¼ã‚¸å…ˆ</th><th>ãƒ¡ãƒ¢</th><th>æ“ä½œ</th>
                </tr> </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <footer style="text-align: center; margin-top: 25px; font-size: 14px; color: #555;">
        åˆ¶ä½œè€…: ã¾ã£ã´ãƒ¼ <a href="https://x.com/mappy_fukugyo" target="_blank" rel="noopener noreferrer" style="color:#3498db; text-decoration:none;">@mappy_fukugyo</a>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('agc-form');
    const tableBody = document.querySelector('#agc-table tbody');
    const editIndexInput = document.getElementById('edit-index');
    const submitBtn = document.getElementById('submit-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const formHeader = document.getElementById('form-header');
    const exportBtn = document.getElementById('export-btn');
    const statusSelect = document.getElementById('status');
    const chargeToGroup = document.getElementById('charge-to-group');
    const mainTitle = document.getElementById('main-title');

    if (localStorage.getItem('agcSimpleTitleFinalV14')) {
        mainTitle.innerHTML = localStorage.getItem('agcSimpleTitleFinalV14');
    }
    mainTitle.addEventListener('blur', function() {
        localStorage.setItem('agcSimpleTitleFinalV14', this.innerHTML);
    });

    let records = JSON.parse(localStorage.getItem('agcSimpleRecordsFinalV14')) || [];

    function renderAll() {
        tableBody.innerHTML = '';
        records.forEach((rec, idx) => {
            let rowClass = '';
            if (rec.status === 'æœªä½¿ç”¨') rowClass = 'status-unused';
            else if (rec.status === 'ãƒãƒ£ãƒ¼ã‚¸æ¸ˆ') rowClass = 'status-charged';
            else if (rec.status === 'ä½¿ç”¨æ¸ˆ') rowClass = 'status-spent';
            
            tableBody.innerHTML += `
                <tr class="${rowClass}">
                    <td>${rec.purchaseDate}</td><td>${rec.source || ''}</td>
                    <td>${(rec.amount || 0).toLocaleString()}å††</td>
                    <td>${rec.code || ''} <button class="copy-btn-table" onclick="copyCode('${rec.code || ''}', this)">ã‚³ãƒ”ãƒ¼</button></td>
                    <td>${rec.status}</td><td>${rec.chargeTo || ''}</td><td>${rec.memo || ''}</td>
                    <td><button class="action-btn edit-btn" onclick="editRecord(${idx})">ç·¨é›†</button><button class="action-btn delete-btn" onclick="deleteRecord(${idx})">å‰Šé™¤</button></td>
                </tr>`;
        });

        let totalUnused = 0, totalCharged = 0, totalSpent = 0;
        records.forEach(rec => {
            if (rec.status === 'æœªä½¿ç”¨') totalUnused += rec.amount || 0;
            else if (rec.status === 'ãƒãƒ£ãƒ¼ã‚¸æ¸ˆ') totalCharged += rec.amount || 0;
            else if (rec.status === 'ä½¿ç”¨æ¸ˆ') totalSpent += rec.amount || 0;
        });

        document.getElementById('total-unused-value').textContent = `${totalUnused.toLocaleString()}å††`;
        document.getElementById('total-charged-value').textContent = `${totalCharged.toLocaleString()}å††`;
        document.getElementById('total-spent-value').textContent = `${totalSpent.toLocaleString()}å††`;
    }

    statusSelect.addEventListener('change', function() {
        chargeToGroup.style.visibility = (this.value === 'ãƒãƒ£ãƒ¼ã‚¸æ¸ˆ') ? 'visible' : 'hidden';
    });

    window.copyCode = function(code, element) {
        if (!code) return;
        navigator.clipboard.writeText(code).then(() => {
            const originalText = element.textContent;
            element.textContent = 'ã‚³ãƒ”ãƒ¼æ¸ˆ!';
            setTimeout(() => { element.textContent = originalText; }, 1500);
        }).catch(err => { console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', err); });
    }

    window.deleteRecord = (idx) => { if (confirm('ã“ã®è¨˜éŒ²ã‚’æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) { records.splice(idx, 1); saveAndRender(); } };
    window.editRecord = (idx) => {
        const rec = records[idx];
        editIndexInput.value = idx;
        const fieldIds = ['purchase-date', 'source', 'amount', 'code', 'status', 'charge-to', 'memo'];
        fieldIds.forEach(id => {
            const propName = id.replace(/-(\w)/g, (_, c) => c.toUpperCase());
            const el = document.getElementById(id);
            if(el) el.value = rec[propName] === undefined ? '' : rec[propName];
        });
        chargeToGroup.style.visibility = (rec.status === 'ãƒãƒ£ãƒ¼ã‚¸æ¸ˆ') ? 'visible' : 'hidden';
        formHeader.textContent = `ğŸ“ è¨˜éŒ² No.${idx + 1} ã‚’ç·¨é›†ä¸­...`; submitBtn.textContent = 'æ›´æ–°ã™ã‚‹'; cancelBtn.style.display = 'inline-block';
        window.scrollTo(0, 0);
    };

    function resetForm() { form.reset(); editIndexInput.value = ''; chargeToGroup.style.visibility = 'hidden'; formHeader.textContent = 'ã‚¢ãƒƒãƒ—ãƒ«ã‚®ãƒ•ãƒˆã‚«ãƒ¼ãƒ‰ã®è¨˜éŒ²'; submitBtn.textContent = 'ç™»éŒ²ã™ã‚‹'; cancelBtn.style.display = 'none'; }
    cancelBtn.addEventListener('click', resetForm);

    function saveAndRender() { records.sort((a, b) => new Date(b.purchaseDate) - new Date(a.purchaseDate)); localStorage.setItem('agcSimpleRecordsFinalV14', JSON.stringify(records)); renderAll(); }

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const recordData = {
            purchaseDate: document.getElementById('purchase-date').value,
            source: document.getElementById('source').value,
            amount: +document.getElementById('amount').value || 0,
            code: document.getElementById('code').value,
            status: document.getElementById('status').value,
            chargeTo: document.getElementById('charge-to').value,
            memo: document.getElementById('memo').value,
        };
        const idx = editIndexInput.value;
        if (idx !== '') { records[idx] = recordData; } else { records.push(recordData); }
        saveAndRender(); resetForm();
    });
    
    exportBtn.addEventListener('click', function() {
        if (records.length === 0) return alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        const headers = ["è³¼å…¥æ—¥", "è³¼å…¥å…ƒ", "é‡‘é¡", "ã‚³ãƒ¼ãƒ‰", "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", "ãƒãƒ£ãƒ¼ã‚¸å…ˆ", "ãƒ¡ãƒ¢"];
        let csvContent = headers.join(",") + "\r\n";
        records.forEach(rec => {
            const row = [rec.purchaseDate, rec.source, rec.amount, `"${rec.code || ''}"`, rec.status, rec.chargeTo, `"${rec.memo || ''}"`];
            csvContent += row.join(",") + "\r\n";
        });
        const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
        const blob = new Blob([bom, csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        const yyyymmdd = new Date().toLocaleDateString('ja-JP').replace(/\//g, '');
        link.download = `agc_simple_records_${yyyymmdd}.csv`;
        link.click();
    });

    renderAll();
});
</script>
</body>
</html>